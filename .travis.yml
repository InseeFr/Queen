language: node_js

addons:
  sonarcloud:
    organization: 'inseefr'

services:
  - docker

sudo: required

node_js:
  - 12.19.0

cache: yarn

install:
  - yarn

before_script:
  - yarn test:ci

script:
  - sonar-scanner
  - yarn build
  - docker build -t $DOCKER_IMAGE .

after_script:
  - bash scripts/gitbook.sh

deploy:
  - skip_cleanup: true
    provider: script
    script: echo "$DOCKER_PASSWORD" | docker login --username "$DOCKER_USERNAME" --password-stdin
      && docker push $DOCKER_IMAGE
    on:
      branch: develop
